# Редактор полигонов

Это приложение позволяет пользователям создавать и редактировать полигоны на карте Leaflet.js.

Данный Django-сервер использует Django Templates для создания интерфейса пользователя и предоставляет широкий спектр операций с полигонами, данные которых хранятся в БД PostgreSQL.

## Основные функции
- Авторизация (с поддержкой super) пользователей и система уведомлений о результатах выполнения операций.
- Создание полигонов путем добавления вершин по клику на карте или вводом координат вручную.
- CRUD-операции с полигонами: отображение списка, создание, обновление и удаление.
- Сохранение названия и геометрии полигона, а также создавшего пользователя и признака пересечения антимеридиана в БД.
- Обнаружение пересечений с другими полигонами и отправка персонифицированного уведомления со ссылкой на форму редактирования.
- Уведомление о пересечениях позволяет перейти на форму редактирования полигона, отображающую пересекающие полигоны.

## Установка приложения под Linux
Следуйте шагам, описанным ниже, чтобы установить и запустить приложение.

### Предварительные требования
- Python 3.7 или выше
- PostgreSQL
- Redis
- Git (если вы клонируете проект)

### Шаги установки
1. **Клонируйте репозиторий или скопируйте файлы проекта:**
   ```bash
   git clone https://github.com/Ezovskih/alliance.git
   cd alliance
   ```

2. **Создайте и активируйте виртуальное окружение:**
   ```bash
   python3 -m venv venv
   source venv/bin/activate
   ```

3. **Установите зависимости:**
   ```bash
   pip install -r requirements.txt
   ```

4. **Настройте и запустите Redis:**
   ```bash
   sudo service redis-server start
   ```

5. **Создайте базу данных с поддержкой PostGIS:**
   ```bash
   sudo apt-get install postgresql postgresql-contrib postgis
   ```
   В интерфейсе PostgreSQL (например, psql) выполните:
   ```sql
   CREATE DATABASE alliance;
   \c alliance;
   CREATE EXTENSION postgis;
   \q
   ```

6. **Примените initial-миграции:**
   ```bash
   python manage.py migrate
   ```

7. **Проверьте настройки приложения:**
   > Убедитесь, что в `settings.py` у вас корректно настроено соединение с БД PostgreSQL - `DATABASES`, брокером сообщений Redis - `CHANNEL_LAYERS`, а также прописаны пути к ГЕО-библиотекам: `GDAL_LIBRARY_PATH`, `GEOS_LIBRARY_PATH` и `PROJ_LIB`.

8. **Запустите Celery worker:**
   ```bash
   celery --app=app worker --pool=threads --concurrency=4
   ```
   > Используемый `pool` может быть другим, в зависимости от среды выполнения.

9. **Создайте суперпользователя приложения:**
   ```bash
   python manage.py createsuperuser
   ```

10. **Запустите приложение:**
   ```bash
   python manage.py runserver
   ```

### Использование приложения
После успешного запуска, перейдите в браузере по адресу http://127.0.0.1:8000/ и начните пользоваться приложением.

Управление пользователями выполняется по адресу http://127.0.0.1:8000/admin/.
